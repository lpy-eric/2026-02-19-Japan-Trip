<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥æœ¬æ»‘é›ªæº«æ³‰ä¹‹æ—… 2026</title>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // Indigo 600
                        secondary: '#EC4899', // Pink 500 (Sakura vibe)
                        surface: '#F8FAFC', // Slate 50
                        snow: '#E0F2FE', // Sky 100
                    },
                    fontFamily: {
                        sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #F1F5F9;
            -webkit-tap-highlight-color: transparent;
        }
        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .card-shadow {
            box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
        }
        /* Mobile specific adjustments */
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
        /* Fix for Phosphor Icons to prevent flickering */
        i[class^="ph-"], i[class*=" ph-"] {
            display: inline-block;
            line-height: 1;
        }
    </style>
</head>
<body class="text-slate-800 h-screen overflow-hidden flex flex-col font-sans">

    <div id="app" class="h-full flex flex-col relative max-w-md mx-auto bg-surface shadow-2xl overflow-hidden w-full">
        
        <!-- Header (Dynamic based on Tab) -->
        <header class="bg-white/80 backdrop-blur-md sticky top-0 z-20 px-6 py-4 border-b border-slate-100 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
                    {{ currentTabTitle }}
                </h1>
                <p class="text-xs text-slate-400 font-medium" v-if="activeTab === 'itinerary'">{{ dateRange }}</p>
                <p class="text-xs text-slate-400 font-medium" v-if="activeTab === 'wallet'">ç¸½é ç®—æ§åˆ¶</p>
            </div>
            <div v-if="activeTab === 'itinerary'" class="flex gap-2">
                 <button @click="resetData" class="text-slate-400 hover:text-red-500 transition">
                    <i class="ph ph-arrow-counter-clockwise text-xl"></i>
                </button>
            </div>
            <div v-if="activeTab === 'wallet'" class="bg-green-50 text-green-600 px-3 py-1 rounded-full text-xs font-bold">
                Â¥ {{ totalExpenses.toLocaleString() }}
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto no-scrollbar scroll-smooth relative bg-slate-50">
            
            <!-- VIEW: ITINERARY -->
            <div v-if="activeTab === 'itinerary'" class="pb-24">
                
                <!-- Date Selector -->
                <div class="flex overflow-x-auto no-scrollbar gap-3 p-4 sticky top-0 z-10 bg-slate-50/95 backdrop-blur-sm">
                    <button 
                        v-for="(day, index) in itinerary" 
                        :key="index"
                        @click="currentDayIndex = index"
                        class="flex-shrink-0 flex flex-col items-center justify-center w-24 h-16 rounded-2xl transition-all duration-300 border"
                        :class="currentDayIndex === index ? 'bg-primary text-white shadow-lg border-primary scale-105' : 'bg-white text-slate-400 border-slate-100'"
                    >
                        <!-- Top Line: Date + Weekday -->
                        <span class="text-[10px] font-medium opacity-80">{{ getDayHeader(day.date) }}</span>
                        <!-- Bottom Line: Day X -->
                        <span class="text-lg font-bold">Day {{ index + 1 }}</span>
                    </button>
                </div>

                <!-- Weather Widget (Contextual) -->
                <div class="px-4 mb-2">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-400 rounded-3xl p-5 text-white shadow-lg relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full blur-xl"></div>
                        <div class="flex justify-between items-end relative z-10">
                            <div>
                                <div class="flex items-center gap-1 text-blue-100 text-sm mb-1">
                                    <i class="ph-fill ph-map-pin"></i>
                                    {{ currentDay.location }}
                                </div>
                                <div class="text-4xl font-bold mb-1">{{ currentDay.weather.temp }}Â°</div>
                                <div class="text-sm font-medium opacity-90">{{ currentDay.weather.desc }}</div>
                            </div>
                            <i :class="['ph-fill text-6xl opacity-90', currentDay.weather.icon]"></i>
                        </div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="px-4 mt-4 space-y-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-bold text-slate-700">ç•¶æ—¥è¡Œç¨‹</h3>
                        <button @click="openAddModal" class="text-primary text-sm font-semibold flex items-center gap-1">
                            <i class="ph-bold ph-plus"></i> æ–°å¢
                        </button>
                    </div>

                    <div v-if="currentDay.events.length === 0" class="text-center py-10 text-slate-400">
                        <i class="ph-duotone ph-calendar-x text-4xl mb-2"></i>
                        <p>å°šç„¡è¡Œç¨‹</p>
                    </div>

                    <div v-for="(event, eIndex) in currentDay.events" :key="event.id" class="group relative flex gap-4">
                        <!-- Time Column -->
                        <div class="flex flex-col items-center">
                            <span class="text-xs font-bold text-slate-400 font-mono">{{ event.time }}</span>
                            <div class="w-0.5 h-full bg-slate-200 mt-2 rounded-full group-last:bg-transparent"></div>
                        </div>

                        <!-- Card -->
                        <div class="flex-1 bg-white p-4 rounded-2xl border border-slate-100 card-shadow mb-4 active:scale-[0.98] transition-transform relative overflow-hidden">
                            <!-- Type Indicator Strip -->
                            <div class="absolute left-0 top-0 bottom-0 w-1" :class="getCategoryColor(event.type)"></div>
                            
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold text-slate-800">{{ event.title }}</h4>
                                    <div v-if="event.note" class="text-xs text-slate-500 mt-1 line-clamp-2">{{ event.note }}</div>
                                </div>
                                <button @click="deleteEvent(eIndex)" class="text-slate-300 hover:text-red-400 p-1">
                                    <i class="ph-bold ph-trash"></i>
                                </button>
                            </div>

                            <!-- Actions Footer -->
                            <div class="mt-3 flex items-center gap-3 pt-3 border-t border-slate-50">
                                <a :href="getMapLink(event.location)" target="_blank" class="flex items-center gap-1 text-xs font-bold text-primary bg-indigo-50 px-2 py-1 rounded-lg hover:bg-indigo-100 transition">
                                    <i class="ph-fill ph-navigation-arrow"></i> å°èˆª
                                </a>
                                <span class="text-xs text-slate-400 flex items-center gap-1">
                                    <i class="ph-fill ph-map-pin"></i> {{ event.location }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: WALLET -->
            <div v-if="activeTab === 'wallet'" class="pb-24 p-4">
                <!-- Summary Card -->
                <div class="bg-slate-800 rounded-3xl p-6 text-white shadow-xl mb-6 relative overflow-hidden">
                    <div class="absolute -right-10 -top-10 w-40 h-40 bg-secondary opacity-20 rounded-full blur-3xl"></div>
                    <p class="text-slate-300 text-sm mb-1">ç›®å‰ç¸½æ¶ˆè²»</p>
                    <h2 class="text-4xl font-bold font-mono">Â¥ {{ totalExpenses.toLocaleString() }}</h2>
                    <div class="mt-4 flex gap-2">
                         <div class="flex-1 bg-white/10 rounded-xl p-2 text-center">
                            <div class="text-xs text-slate-400">äº¤é€š</div>
                            <div class="font-bold">Â¥ {{ getCategoryTotal('transport') }}</div>
                         </div>
                         <div class="flex-1 bg-white/10 rounded-xl p-2 text-center">
                            <div class="text-xs text-slate-400">é£²é£Ÿ</div>
                            <div class="font-bold">Â¥ {{ getCategoryTotal('food') }}</div>
                         </div>
                         <div class="flex-1 bg-white/10 rounded-xl p-2 text-center">
                            <div class="text-xs text-slate-400">è³¼ç‰©</div>
                            <div class="font-bold">Â¥ {{ getCategoryTotal('shopping') }}</div>
                         </div>
                    </div>
                </div>

                <!-- Add Expense Form -->
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-6">
                    <h3 class="font-bold text-slate-700 mb-3 text-sm">æ–°å¢æ¶ˆè²»</h3>
                    <div class="flex gap-2 mb-2">
                        <input v-model="newExpense.title" type="text" placeholder="é …ç›® (å¦‚: æ™šé¤)" class="flex-1 bg-slate-50 border-none rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none">
                        <input v-model.number="newExpense.amount" type="number" placeholder="Â¥ é‡‘é¡" class="w-24 bg-slate-50 border-none rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div class="flex justify-between items-center">
                        <select v-model="newExpense.category" class="bg-slate-50 text-slate-500 text-xs rounded-lg px-2 py-2 border-none outline-none">
                            <option value="food">ğŸ± é£²é£Ÿ</option>
                            <option value="transport">ğŸš… äº¤é€š</option>
                            <option value="shopping">ğŸ›ï¸ è³¼ç‰©</option>
                            <option value="ticket">ğŸŸï¸ é–€ç¥¨</option>
                            <option value="other">ğŸ“¦ å…¶ä»–</option>
                        </select>
                        <button @click="addExpense" class="bg-slate-800 text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-black transition">
                            è¨˜ä¸€ç­†
                        </button>
                    </div>
                </div>

                <!-- Expense List -->
                <h3 class="font-bold text-slate-700 mb-2 px-1">æ¶ˆè²»ç´€éŒ„</h3>
                <div class="space-y-2">
                    <div v-for="(item, index) in expenses" :key="item.id" class="bg-white p-3 rounded-xl border border-slate-100 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-lg" :class="getExpenseIconBg(item.category)">
                                {{ getExpenseIcon(item.category) }}
                            </div>
                            <div>
                                <div class="font-bold text-slate-700 text-sm">{{ item.title }}</div>
                                <div class="text-xs text-slate-400">{{ formatDate(item.date) }}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="font-bold font-mono text-slate-800">Â¥{{ item.amount }}</div>
                            <button @click="deleteExpense(index)" class="text-slate-300 hover:text-red-500">
                                <i class="ph-bold ph-x"></i>
                            </button>
                        </div>
                    </div>
                    <div v-if="expenses.length === 0" class="text-center py-6 text-slate-400 text-sm">
                        é‚„æ²’æœ‰æ¶ˆè²»ç´€éŒ„ï¼Œé–‹å§‹æ•—å®¶å§ï¼
                    </div>
                </div>
            </div>

             <!-- VIEW: SETTINGS/INFO (Simple view for now) -->
             <div v-if="activeTab === 'info'" class="p-6 pb-24 text-center">
                <div class="w-24 h-24 bg-indigo-100 rounded-full mx-auto flex items-center justify-center mb-4 text-primary">
                    <i class="ph-duotone ph-airplane-takeoff text-4xl"></i>
                </div>
                <h2 class="text-xl font-bold text-slate-800">æ±äº¬æ»‘é›ªäº”æ—¥éŠ</h2>
                <p class="text-slate-500 mt-2 text-sm">èˆªç­ï¼šUO693</p>
                <div class="mt-8 bg-white p-4 rounded-xl text-left text-sm space-y-3 shadow-sm border border-slate-100">
                    <p class="font-bold border-b pb-2">ç·Šæ€¥è¯çµ¡</p>
                    <div class="flex justify-between"><span>è­¦å¯Ÿå±€</span><span class="font-mono text-primary">110</span></div>
                    <div class="flex justify-between"><span>æ•‘è­·è»Š</span><span class="font-mono text-primary">119</span></div>
                    <div class="flex justify-between"><span>é§æ—¥ä»£è¡¨è™•</span><span class="font-mono text-primary">+81-3-3280-7111</span></div>
                </div>
                <p class="mt-10 text-xs text-slate-300">è¡Œç¨‹è¦åŠƒ by Gemini</p>
            </div>

        </main>

        <!-- ADD EVENT MODAL -->
        <div v-if="showModal" class="absolute inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg">æ–°å¢è¡Œç¨‹</h3>
                    <button @click="closeModal" class="bg-slate-100 rounded-full p-2 hover:bg-slate-200">
                        <i class="ph-bold ph-x"></i>
                    </button>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1">æ™‚é–“</label>
                        <input v-model="newEvent.time" type="time" class="w-full bg-slate-50 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1">æ´»å‹•åç¨±</label>
                        <input v-model="newEvent.title" type="text" placeholder="ä¾‹ï¼šåƒæ‹‰éºµ" class="w-full bg-slate-50 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1">åœ°é» (ç”¨æ–¼å°èˆª)</label>
                        <input v-model="newEvent.location" type="text" placeholder="ä¾‹ï¼šä¸€è˜­æ‹‰éºµ ä¸Šé‡åº—" class="w-full bg-slate-50 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 ml-1">é¡å‹</label>
                        <div class="flex gap-2 mt-1">
                            <button @click="newEvent.type = 'transport'" :class="newEvent.type === 'transport' ? 'bg-indigo-100 text-indigo-600 border-indigo-200' : 'bg-slate-50 text-slate-400 border-transparent'" class="flex-1 py-2 rounded-lg text-sm border font-medium">äº¤é€š</button>
                            <button @click="newEvent.type = 'activity'" :class="newEvent.type === 'activity' ? 'bg-pink-100 text-pink-600 border-pink-200' : 'bg-slate-50 text-slate-400 border-transparent'" class="flex-1 py-2 rounded-lg text-sm border font-medium">æ´»å‹•</button>
                            <button @click="newEvent.type = 'food'" :class="newEvent.type === 'food' ? 'bg-orange-100 text-orange-600 border-orange-200' : 'bg-slate-50 text-slate-400 border-transparent'" class="flex-1 py-2 rounded-lg text-sm border font-medium">ç¾é£Ÿ</button>
                        </div>
                    </div>
                </div>

                <button @click="confirmAddEvent" class="w-full bg-primary text-white font-bold py-3.5 rounded-2xl mt-6 shadow-lg shadow-indigo-200 hover:shadow-indigo-300 transition transform active:scale-95">
                    ç¢ºèªæ–°å¢
                </button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bg-white border-t border-slate-100 p-2 safe-bottom z-30 flex justify-around items-center">
            <button @click="activeTab = 'itinerary'" :class="activeTab === 'itinerary' ? 'text-primary' : 'text-slate-300 hover:text-slate-500'" class="flex flex-col items-center p-2 transition-colors w-16">
                <i :class="activeTab === 'itinerary' ? 'ph-fill' : 'ph-bold'" class="ph ph-map-trifold text-2xl mb-1"></i>
                <span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            
            <button @click="activeTab = 'wallet'" :class="activeTab === 'wallet' ? 'text-primary' : 'text-slate-300 hover:text-slate-500'" class="flex flex-col items-center p-2 transition-colors w-16">
                <i :class="activeTab === 'wallet' ? 'ph-fill' : 'ph-wallet' " class="ph ph-wallet text-2xl mb-1"></i>
                <span class="text-[10px] font-bold">è¨˜å¸³</span>
            </button>

            <button @click="activeTab = 'info'" :class="activeTab === 'info' ? 'text-primary' : 'text-slate-300 hover:text-slate-500'" class="flex flex-col items-center p-2 transition-colors w-16">
                <i :class="activeTab === 'info' ? 'ph-fill' : 'ph-info'" class="ph ph-info text-2xl mb-1"></i>
                <span class="text-[10px] font-bold">è³‡è¨Š</span>
            </button>
        </nav>

    </div>

    <script>
        const { createApp, ref, computed, reactive, onMounted, watch } = Vue;

        createApp({
            setup() {
                const activeTab = ref('itinerary');
                const showModal = ref(false);
                const currentDayIndex = ref(0);

                // Initial Data Structure based on User's Itinerary
                const defaultItinerary = [
                    {
                        date: '2026/02/19',
                        weekday: 'é€±å››',
                        location: 'æ±äº¬ä¸Šé‡',
                        weather: { temp: 8, desc: 'æ™´æ™‚å¤šé›²', icon: 'ph-sun-dim' },
                        events: [
                            { id: 1, time: '18:05', title: 'æŠµé”æ±äº¬æˆç”°æ©Ÿå ´', location: 'æˆç”°åœ‹éš›æ©Ÿå ´', type: 'transport', note: 'UO693 èˆªç­' },
                            { id: 2, time: '19:30', title: 'æ­ä¹˜ Skyliner', location: 'äº¬æˆä¸Šé‡ç«™', type: 'transport', note: 'ç›´é”ä¸Šé‡ç´„ 45 åˆ†é˜' },
                            { id: 3, time: '20:30', title: 'é˜¿ç¾æ©«ä¸æ™šé¤', location: 'é˜¿ç¾æ©«ä¸', type: 'food', note: 'æ¨è–¦ï¼šå±…é…’å±‹æˆ–è¿´è½‰å£½å¸' },
                            { id: 4, time: '22:00', title: 'å…¥ä½é£¯åº—', location: 'ä¸Šé‡ç«™é™„è¿‘', type: 'activity', note: 'Check-in ä¼‘æ¯' }
                        ]
                    },
                    {
                        date: '2026/02/20',
                        weekday: 'é€±äº”',
                        location: 'è¶Šå¾Œæ¹¯æ¾¤',
                        weather: { temp: -2, desc: 'å¤§é›ª', icon: 'ph-snowflake' },
                        events: [
                            { id: 5, time: '08:00', title: 'ä¸Šè¶Šæ–°å¹¹ç·šå‡ºç™¼', location: 'ä¸Šé‡ç«™', type: 'transport', note: 'å‰å¾€ GALA æ¹¯æ¾¤' },
                            { id: 6, time: '09:30', title: 'GALA æ¹¯æ¾¤æ»‘é›ª', location: 'GALAæ¹¯æ¾¤æ»‘é›ªå ´', type: 'activity', note: 'ç§Ÿå€Ÿè£å‚™ï¼Œäº«å—æ»‘é›ªæ¨‚è¶£' },
                            { id: 7, time: '16:00', title: 'å‰å¾€æº«æ³‰æ—…é¤¨', location: 'è¶Šå¾Œæ¹¯æ¾¤æº«æ³‰è¡—', type: 'transport', note: 'æ­ä¹˜æ¥é§è»Šæˆ–è¨ˆç¨‹è»Š' },
                            { id: 8, time: '18:30', title: 'ä¸€æ³Šå…©é£Ÿæ™šé¤', location: 'æº«æ³‰æ—…é¤¨', type: 'food', note: 'äº«å—æ‡·çŸ³æ–™ç†' }
                        ]
                    },
                    {
                        date: '2026/02/21',
                        weekday: 'é€±å…­',
                        location: 'è¶Šå¾Œæ¹¯æ¾¤/ä¸Šé‡',
                        weather: { temp: 2, desc: 'é™£é›ªè½‰æ™´', icon: 'ph-cloud-snow' },
                        events: [
                            { id: 9, time: '09:00', title: 'æ™¨é–“æº«æ³‰ & æ—©é¤', location: 'æº«æ³‰æ—…é¤¨', type: 'activity', note: 'äº«å—æœ€å¾Œçš„æº«æ³‰æ™‚å…‰' },
                            { id: 10, time: '11:00', title: 'æ¸…é…’åšç‰©é¤¨ (Ponshukan)', location: 'è¶Šå¾Œæ¹¯æ¾¤ç«™', type: 'activity', note: '500æ—¥åœ“è©¦é£²å„ç¨®æ¸…é…’' },
                            { id: 11, time: '13:00', title: 'å—é­šæ²¼ç±³åˆé¤', location: 'è¶Šå¾Œæ¹¯æ¾¤ç«™', type: 'food', note: 'çˆ†å½ˆé£¯ç³°' },
                            { id: 12, time: '15:00', title: 'è¿”å›æ±äº¬', location: 'ä¸Šé‡ç«™', type: 'transport', note: 'æ–°å¹¹ç·šå›ä¸Šé‡' }
                        ]
                    },
                    {
                        date: '2026/02/22',
                        weekday: 'é€±æ—¥',
                        location: 'æ±äº¬å¸‚å€',
                        weather: { temp: 10, desc: 'æ™´æœ—', icon: 'ph-sun' },
                        events: [
                            { id: 13, time: '09:30', title: 'æ·ºè‰å¯ºåƒæ‹œ', location: 'æ·ºè‰å¯ºé›·é–€', type: 'activity', note: 'é«”é©—æ±Ÿæˆ¶é¢¨æƒ…' },
                            { id: 14, time: '13:00', title: 'æ–°å®¿/æ¾€è°·è³¼ç‰©', location: 'æ–°å®¿', type: 'shopping', note: 'ç™¾è²¨å…¬å¸èˆ‡è—¥å¦åº—' },
                            { id: 15, time: '18:00', title: 'æ±äº¬å¤œæ™¯', location: 'å…­æœ¬æœ¨ä¹‹ä¸˜', type: 'activity', note: 'æˆ–æ™´ç©ºå¡”' }
                        ]
                    },
                    {
                        date: '2026/02/23',
                        weekday: 'é€±ä¸€',
                        location: 'æ±äº¬ä¸Šé‡',
                        weather: { temp: 9, desc: 'å¤šé›²', icon: 'ph-cloud' },
                        events: [
                            { id: 16, time: '10:00', title: 'ä¸Šé‡å…¬åœ’æ•£ç­–', location: 'ä¸Šé‡æ©è³œå…¬åœ’', type: 'activity', note: 'å‹•ç‰©åœ’æˆ–åšç‰©é¤¨' },
                            { id: 17, time: '13:00', title: 'æœ€å¾Œæ¡è²·', location: 'å¤šæ…¶å±‹', type: 'shopping', note: 'ä¼´æ‰‹ç¦®è£œè²¨' },
                            { id: 18, time: '17:30', title: 'å‰å¾€æ©Ÿå ´', location: 'äº¬æˆä¸Šé‡ç«™', type: 'transport', note: 'æ­ä¹˜ Skyliner' },
                            { id: 19, time: '20:55', title: 'æ­æ©Ÿè¿”æ¸¯', location: 'æˆç”°æ©Ÿå ´ T2', type: 'transport', note: 'UO693' }
                        ]
                    }
                ];

                const itinerary = ref(JSON.parse(localStorage.getItem('japan_trip_itinerary')) || defaultItinerary);
                const expenses = ref(JSON.parse(localStorage.getItem('japan_trip_expenses')) || []);

                // Expense Input State
                const newExpense = reactive({
                    title: '',
                    amount: '',
                    category: 'food'
                });

                // New Event Input State
                const newEvent = reactive({
                    time: '12:00',
                    title: '',
                    location: '',
                    type: 'activity'
                });

                // Watchers for Persistence
                watch(itinerary, (newVal) => {
                    localStorage.setItem('japan_trip_itinerary', JSON.stringify(newVal));
                }, { deep: true });

                watch(expenses, (newVal) => {
                    localStorage.setItem('japan_trip_expenses', JSON.stringify(newVal));
                }, { deep: true });

                // Computed Properties
                const currentDay = computed(() => itinerary.value[currentDayIndex.value]);
                const dateRange = computed(() => '2026/02/19 - 02/23');
                const currentTabTitle = computed(() => {
                    const map = {
                        'itinerary': 'è¡Œç¨‹è¦åŠƒ',
                        'wallet': 'æ—…è²»ç®¡å®¶',
                        'info': 'é‡è¦è³‡è¨Š'
                    };
                    return map[activeTab.value];
                });

                const totalExpenses = computed(() => {
                    return expenses.value.reduce((acc, curr) => acc + (curr.amount || 0), 0);
                });

                // Methods
                const getCategoryColor = (type) => {
                    const colors = {
                        'transport': 'bg-indigo-500',
                        'food': 'bg-orange-500',
                        'activity': 'bg-pink-500',
                        'shopping': 'bg-emerald-500'
                    };
                    return colors[type] || 'bg-slate-500';
                };

                const getMapLink = (location) => {
                    return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
                };

                const getDayHeader = (dateStr) => {
                    const d = new Date(dateStr);
                    const m = (d.getMonth() + 1).toString().padStart(2, '0');
                    const day = d.getDate().toString().padStart(2, '0');
                    // Get English weekday: Mon, Tue, etc.
                    const week = d.toLocaleDateString('en-US', { weekday: 'short' });
                    return `${m}/${day} (${week})`;
                };

                const openAddModal = () => {
                    showModal.value = true;
                };

                const closeModal = () => {
                    showModal.value = false;
                    // reset form
                    newEvent.title = '';
                    newEvent.location = '';
                    newEvent.time = '12:00';
                };

                const confirmAddEvent = () => {
                    if(!newEvent.title) return;
                    
                    const event = {
                        id: Date.now(),
                        time: newEvent.time,
                        title: newEvent.title,
                        location: newEvent.location || currentDay.value.location,
                        type: newEvent.type,
                        note: ''
                    };
                    
                    // Add and Sort by time
                    itinerary.value[currentDayIndex.value].events.push(event);
                    itinerary.value[currentDayIndex.value].events.sort((a, b) => a.time.localeCompare(b.time));
                    
                    closeModal();
                };

                const deleteEvent = (index) => {
                    if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) {
                        itinerary.value[currentDayIndex.value].events.splice(index, 1);
                    }
                };

                const addExpense = () => {
                    if(!newExpense.title || !newExpense.amount) return;
                    expenses.value.unshift({
                        id: Date.now(),
                        title: newExpense.title,
                        amount: newExpense.amount,
                        category: newExpense.category,
                        date: new Date()
                    });
                    newExpense.title = '';
                    newExpense.amount = '';
                };

                const deleteExpense = (index) => {
                    expenses.value.splice(index, 1);
                };

                const getExpenseIcon = (cat) => {
                    const map = { 'food': 'ğŸ±', 'transport': 'ğŸš…', 'shopping': 'ğŸ›ï¸', 'ticket': 'ğŸŸï¸', 'other': 'ğŸ“¦' };
                    return map[cat] || 'ğŸ’¸';
                };

                const getExpenseIconBg = (cat) => {
                    const map = { 'food': 'bg-orange-100', 'transport': 'bg-indigo-100', 'shopping': 'bg-emerald-100', 'ticket': 'bg-purple-100', 'other': 'bg-slate-100' };
                    return map[cat];
                };

                const getCategoryTotal = (cat) => {
                    const total = expenses.value
                        .filter(e => e.category === cat)
                        .reduce((acc, curr) => acc + curr.amount, 0);
                    return total.toLocaleString();
                };

                const formatDate = (dateStr) => {
                    const d = new Date(dateStr);
                    return `${d.getMonth()+1}/${d.getDate()}`;
                };

                const resetData = () => {
                    if(confirm('é‡ç½®å°‡æœƒæ¸…é™¤æ‰€æœ‰æ‚¨æ–°å¢çš„è³‡æ–™ï¼Œæ¢å¾©æˆé è¨­è¡Œç¨‹ï¼Œç¢ºå®šå—ï¼Ÿ')) {
                        localStorage.removeItem('japan_trip_itinerary');
                        localStorage.removeItem('japan_trip_expenses');
                        window.location.reload();
                    }
                }

                return {
                    activeTab,
                    showModal,
                    currentDayIndex,
                    itinerary,
                    currentDay,
                    dateRange,
                    currentTabTitle,
                    getCategoryColor,
                    getMapLink,
                    getDayHeader, // Added helper
                    openAddModal,
                    closeModal,
                    newEvent,
                    confirmAddEvent,
                    deleteEvent,
                    // Wallet
                    expenses,
                    newExpense,
                    totalExpenses,
                    addExpense,
                    deleteExpense,
                    getExpenseIcon,
                    getExpenseIconBg,
                    getCategoryTotal,
                    formatDate,
                    resetData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>